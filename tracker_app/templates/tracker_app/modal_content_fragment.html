{% load i18n %}
{% load static %}

<!-- s -->

<!-- STATUS COUNTERS SECTION -->
<section class="page-section mcc-blue my-2 py-5 rounded">
  <div class="container">
    <div class="row align-items-center">
      <!-- LEFT COLUMN -->
      <div class="col-lg-5 mb-lg-0">
        <p class="fs-6 bigger-font yellow-color">
         {% blocktranslate trimmed %}In line with Meath Digital's vision, goals and operational objectives, the following progress has been made in Digital Services:{% endblocktranslate %}
        </p>
      </div>

      <!-- RIGHT COLUMN -->
      <div class="col-lg-7">
        <div class="row g-3">
          <!-- Completed -->
          <div class="col-12">
            <div class="card mcc-green text-white shadow-sm p-3 status-card" data-status="COMPLETED">
              <div class="d-flex justify-content-between align-items-center">
                <p class="card-text uppercase-class mb-0 fw-bold">
                  <i class="fas fa-check-circle icon-spacing fa-2x"></i> {% trans "Actions Completed" %}
                </p>
                <h2 class="display-6 mb-0 counter-value" data-target="{{ counts.completed }}" aria-label="Completed actions">
                          {{ counts.completed }}
                </h2>
              </div>
            </div>
          </div>

          <!-- In Progress -->
          <div class="col-12">
            <div class="card mcc-yellow text-dark shadow-sm p-3 status-card" data-status="IN_PROGRESS">
              <div class="d-flex justify-content-between align-items-center">
                <p class="card-text uppercase-class mb-0 fw-bold">
                  <i class="fas fa-hourglass-half icon-spacing fa-2x"></i> {% trans "Actions In Progress" %}
                </p>
                <h2 class="display-6 mb-0 counter-value" data-target="{{ counts.in_progress }}" aria-label="In-progress actions">
                  {{ counts.in_progress }}
                </h2>
              </div>
            </div>
          </div>

          <!-- Not Started -->
          <div class="col-12">
            <div class="card mcc-red text-white shadow-sm p-3 status-card" data-status="NOT_STARTED">
              <div class="d-flex justify-content-between align-items-center">
                <p class="card-text uppercase-class mb-0 fw-bold">
                  <i class="fas fa-times-circle icon-spacing fa-2x"></i> {% trans "Actions Not Started" %}
                </p>
                <h2 class="display-6 mb-0 counter-value" data-target="{{ counts.not_started }}" aria-label="Not started actions">
                  {{ counts.not_started }}
                </h2>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- MAIN ACCORDION AND TABLE SECTION -->
<div class="modal-body-content" id="accordion-view-container">

    {% for objective in theme.objectives.all %}
        <div class="accordion-item">
            <button class="accordion-title" onclick="toggleAccordion(this)">
               {% trans "Objective" %} - {{ objective.display_title }}
                <i class="fa-solid fa-angle-down"></i>
            </button>
            
            <div class="accordion-content">
                <div>
                {% if objective.display_description %}
                   <strong> <p class="objective-p">{{ objective.display_description|safe }}</p></strong>
                {% endif %}
                </div>

                {% if objective.approved_actions %}
                    <div class="action-table-container">
                        <table class="action-table">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">{% trans "Action" %}</th>
                                    <th style="width: 40%;">{% trans "Description" %}</th>
                                    <th style="width: 20%;">{% trans "Status" %}</th>
                                    <th style="width: 15%;" >{% trans "Details" %}</th>
                                </tr>
                            </thead>
                             <tbody>
                                {% for action in objective.approved_actions %}
                                    <tr class="action-summary-row status-{{ action.status|lower }}" data-action-id="{{ action.id }}"> 
                                        <td class="title-col">
                                            <strong>{{ action.title }}</strong><br>
                                        </td>
                                         <td class="objective-col">
                                            <p>{{ action.display_small_description }}</p>
                                        </td>
                                        <td class="status-col">
                                            <span class="status-badge status-{{ action.status|lower }}">{{ action.get_status_display }}</span>
                                        </td>
                                        <td class="details-col text-right">
                                            <button class="btn btn-sm toggle-details view-button universal-action-button" onclick="handleDetailsToggle(this)">{% trans "View" %}</button>
                                            <button class="btn btn-sm toggle-details close-button universal-action-button" style="display: none;" onclick="handleDetailsToggle(this)">&minus;</button>
                                        </td>
                                    </tr> 
                                    
                                   
                                      <tr class="full-details" style="display: none;">
                                        
                                        <td colspan="4" style="padding: 0;"> 
                                            <div class="details-content" style="padding: 20px; background-color: #fff; border-bottom: 2px solid #ddd;">
                                                <h5 class="fw-bold">{% trans "Action Description:" %}</h5>
                                                <div>{{ action.display_description|safe }}</div>
                                                
                                                {% if action.status != 'NOT_STARTED' %}
                                                    <hr class="bg-light">
                                                    <h5 class="fw-bold">{% trans "Latest Update:" %}</h5>
                                                    <div>{{ action.display_update|safe }}</div>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>   
                         
   


                        </table>


                    </div>
                {% else %}
                    <p>{% trans "There are no actions for this objective yet." %}</p>
                {% endif %}
            </div>
        </div>
    {% empty %}
        <p>{% trans "No objectives found for this theme yet." %}</p>
    {% endfor %}
</div>

 <div id="filtered-table-view-container" style="display: none;"></div> 
